{% extends "app/layout.html" %}
{% load staticfiles %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'app/content/css/flickity-docs.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'app/content/css/catalog/catalog.css' %}" />
{% endblock %}

{% block screen %}
<!--<div class="main-screen" style="background-image: url('/media/{{thing.random_image}}')">
    <div class="main-screen__conteiner">
        <div class="main-title">{{title}}</div>
        <br />
        <div class="main-title_descr">{{message}}</div>
        <br />
        {{year}}
    </div>
</div>-->
{% endblock %}

{% block content %}

<div class="main_content thing-content">
    <div class="foto_cost slider"></div>
    <div class="title">{{thing.title}}</div>
    <div class="desc">
        <div class="descr">{{thing.descr}}</div>
    </div>
    <div class="variacii">
        <p>Размеры</p>
        <div class="sizes">{{thing.sizes|safe}}</div>
        <p>Цвета</p>
        <div class="colors">{{thing.colortile_korz|safe}}</div>
        <div class="cost"><p>Цена: {{thing.cost}}</p></div>
    </div>
    <div id="btn-id" class="btn-base btn-light" data-id="{{thing.id}}" onclick="add(this)"><p>В корзину</p></div>
    <form action="{% url "cart:cart_add" thing.id %}" method="post">
    {{ cart_product_form }}
    {% csrf_token %}
    <input type="submit" value="Add to cart">
</form>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static '/app/slick/slick.min.js' %}"></script>
<script type="text/javascript">
    function Slider(e) {
        var settings = {
            autoplay: false,
            //autoplaySpeed: 7000,
            slidesToShow: 1,
            centerMode: true,
            centerPadding: '0px',
            arrows: false,
            dots: true,
            infinite: true,
            speed: 300,
            fade: false,
            cssEase: 'linear'
        }
        $(".foto_cost").removeClass("slick-initialized slick-slider slick-dotted");
            $(".foto_cost").slick(settings);
    };

    function getphoto(v) {
        var request = $.ajax({
            url: `/getthingphtotoss/${v}/`,
            method: "get",
            // contentType: 'application/json; charset=utf-8',
            // data: { korzina: stroka },
            // dataType: 'text',
        });

        request.done(function (msg) {
            var m = JSON.parse(msg)
            $(".foto_cost").html(m.img);
            $("#btn-id").attr("data-id", m.id);
            Slider();
        });

        request.fail(function (jqXHR, textStatus) {
            $(".colors").html(`Извините, произошла ошибка ${jqXHR}\n${textStatus}`);
        });
    }

    function getcolors(t, s) {
        $('div[id^="size-"]').removeClass('size-select');
        $("div[id^='size-"+s+"']").addClass('size-select');
        var request = $.ajax({
            url: `/getthingcolors/${t}/${s}/`,
            method: "get",
            // contentType: 'application/json; charset=utf-8',
            // data: { korzina: stroka },
            // dataType: 'text',
        });

        request.done(function (msg) {
            $(".colors").html(msg);
            $('.colors div').removeClass('size-select');
            $(".colors div:first").addClass('size-select');
            getphoto($(".colors div:first").attr("data-var"));
            $("div[id^='color-']").click(function () {
                getphoto(this.getAttribute("data-var"));
            //Slider();
            });
        });

        request.fail(function (jqXHR, textStatus) {
            $(".colors").html(`Извините, произошла ошибка ${jqXHR}\n${textStatus}`);
        });
    }

    $('div[id^="size-"]').click(function () {
        getcolors(this.getAttribute("data-tovar"), this.getAttribute("data-size"));
            //Slider();
    });

    function add(e) {
        let id = e.getAttribute("data-id");
        korz.AddTovar(id, 1);
    }

    $(document).ready(function () {
        var s = $(".sizes div:first");
        s.addClass('size-select');
        getcolors(s.attr("data-tovar"), s.attr("data-size"));
        //Slider();
    });
</script>
{% endblock %}